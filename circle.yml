machine:
  services:
    - docker

# ubuntu is an ancient word for outdated dependencies
dependencies:
  pre:
      - sudo add-apt-repository ppa:mc3man/trusty-media -y;
      - sudo apt-get update; sudo apt-get install ffmpeg;
      - git clone git@github.com:cmusphinx/sphinxbase.git
      - git clone git@github.com:cmusphinx/pocketsphinx.git
      - cd sphinxbase; ./autogen.sh; make; sudo make install;
      - cd pocketsphinx; ./autogen.sh; make clean all; sudo make install

database:
  override:
    - git clone https://github.com/awesomeit/kagu kagu
    - cd kagu; bundle; bundle exec rake db:reset; bundle exec rake db:reset DISABLE_DATABASE_ENVIRONMENT_CHECK=1;

test:
  pre:
    - bundle exec rubocop
  post: 
    - bundle exec codeclimate-test-reporter

deployment:
  production:
    branch: wtf-pls-give-logs
    commands:
      - >
        heroku plugins:install heroku-container-registry;
        docker login --email=_ --username=_ --password=${NOT_DOCKER_HEROKU_API_KEY} registry.heroku.com;
        heroku container:push worker -a talkbirdy-myna;